# AGENTS.md · Corvelloni Contabilidade
Operating rules for code agents in this repository. Applies to the entire repo.

## Scope
- Perform one task per run, one commit per task.
- Do not create branches or rewrite history.
- Leave a clean worktree at the end.

## Environment
- Node.js ≥ 18 and npm ≥ 9.
- Agent OS may be Linux; local user is Windows.
- Shells: bash on Linux/macOS, PowerShell on Windows.

## Repository layout (high level)
~~~txt
/
├─ index.html
├─ ajuda/
├─ calc/
│  ├─ clt-vs-pj/  ├ custo-abrir-cnpj/  ├ fator-r/  ├ impostos-pj/  ├ rescisao/  └ salario-liquido/
├─ duvidas/
│  ├─ index.html  ├ como-abrir-empresa/  └ como-funciona-simples/
├─ assets/ {css, js, img, icons}
├─ data/
├─ docs/   # build output for GitHub Pages
├─ site.webmanifest  robots.txt  sitemap.xml  404.html
├─ vite.config.js
├─ .eslintrc.json  .stylelintrc.json  .htmlhintrc  .nojekyll  .gitignore  .gitattributes
├─ README.md
└─ AGENTS.md
~~~

## Critical rule: `/docs` directory

 Important: The /docs Folder
The `/docs` folder contains the production version of the site, automatically generated by the `npm run build` command.

**NEVER** edit files inside this folder manually. Any changes will be permanently lost on the next build.
For any task involving code analysis, review, or modification, this folder must be completely ignored.
Work must focus exclusively on the projects source files (root HTML and content under `/assets`, `/calc`, `/duvidas`, `/ajuda`).

## Mandatory command sequence (before finishing any task)
### Linux/macOS
~~~bash
npm ci
npm run check        # eslint + stylelint + htmlhint + build
npm run preview -s || true
git status
~~~
### Windows
~~~powershell
npm ci
npm run check
npm run preview
git status
~~~

## Git rules
- No branches. No history rewrites.
- If a check fails, fix and rerun.
- Commit edited source files **and** the generated `/docs/`.
- End with `git status` clean.

## Build and dev
- Dev: `npm run dev` → http://localhost:5173 (default Vite port).
- Build: `npm run build` → writes to `/docs`.
- Preview: `npm run preview` (no auto-open).
- Do not hand-edit files in `/docs`.

## CSS guidelines (ITCSS + BEM)
- Paths: `assets/css/{base,objects,components,utilities}` and `assets/css/main.css`.
- Import order inside `main.css`:
  1) `base/_settings.css` (design tokens, z-index map, color vars)
  2) `base/_normalize.css`
  3) `base/_typography.css` (global type scale, font stacks)
  4) `base/_print.css`
  5) `objects/_o-*.css`
  6) `components/_c-*.css`
  7) `utilities/_u-*.css`
- Naming: `.o-*` for layout objects, `.c-*` for components, `.u-*` for utilities.
- Harmony rule: component CSS (e.g., `c-nav`, `c-header`) must consume global tokens from `base/_settings.css` and must not override other components scopes.
- No inline styles. No JS-injected inline CSS. States via classes (e.g., `.is-open`).

## JS guidelines (ES Modules)
- Single entry: `assets/js/app.js` with `type="module"`.
- Modules in `assets/js/modules/`.
- Global features: import directly in `app.js`.
- Page-specific features: dynamic `import()` behind feature detection or route checks.
~~~txt
assets/js/
├─ app.js
└─ modules/
   ├─ nav.js
   ├─ enhance.js
   ├─ year.js
   ├─ header-over-hero.js
   ├─ help-search.js
   └─ calc-*.js
~~~

## HTML rules
- Use relative asset paths like `assets/...` to work in dev and build.
- Keep header and footer consistent across pages.
- Accessible dropdown pattern: trigger `button.c-nav__link[aria-expanded]` + panel `.c-dropdown[hidden]`.

## Accessibility
- Visible focus with `:focus-visible`.
- Touch targets ≥ 44px.
- Toggle `aria-expanded` with JS; show/hide via `[hidden]`.
- Respect `prefers-reduced-motion`.

## Images and icons
- Logo SVG at `assets/img/svg/logo.svg` with proper `viewBox`.
- PWA icons in `assets/icons/`: `android-chrome-192.png`, `android-chrome-512.png`, `icon-192-maskable.png`, `icon-512-maskable.png`, `apple-touch-icon.png`, `favicon-16.png`, `favicon-32.png`.
- Content images under `assets/img/{webp,avif}`. Use `loading="lazy"` outside the hero.

## Adding a new page
1) Create `folder/index.html` under `ajuda/`, `duvidas/`, or `calc/<slug>/`.
2) Include:
   - `<link rel="stylesheet" href="assets/css/main.css">`
   - `<script type="module" src="assets/js/app.js"></script>`
3) Update navigation if required.
4) Page-specific JS: add a module in `assets/js/modules/` and load it via `import()` in `app.js`.
5) Run `npm run check`.
6) If missing from build, add path to `vite.config.js > build.rollupOptions.input`.

## Acceptance criteria
- `npm run check` passes.
- Navigation works in dev and preview.
- `/docs` generated and committed.
- Basic a11y verified (tab order, focus visible, keyboard dropdown).
- No broken paths.

## Common tasks
- Header/Nav/Dropdown:
  - CSS only in `_c-header.css`, `_c-nav.css`, `_c-dropdown.css`.
  - JS only in `modules/nav.js`.
- Logo size:
  - Adjust `.c-brand__logo` via `block-size`.
  - Do not change `--header-height`.

## Troubleshooting

### Restore missing npm scripts (run once)
~~~bash
npm pkg set scripts.dev="vite"
npm pkg set scripts.start="vite"
npm pkg set scripts.build="vite build"
npm pkg set scripts.preview="vite preview -s"
npm pkg set scripts['lint:css']="stylelint \"assets/css/**/*.css\" --allow-empty-input"
npm pkg set scripts['lint:js']="eslint \"assets/js/**/*.js\""
npm pkg set scripts['lint:html']="htmlhint \"**/*.html\""
npm pkg set scripts.lint="npm run lint:html && npm run lint:css && npm run lint:js"
npm pkg set scripts.check="npm run lint && npm run build"
~~~

### `npm run check` failing due to proxy or script
~~~bash
npm config delete http-proxy
npm config delete https-proxy
npm pkg set scripts.check="npm run lint && npm run build"
npm run check
~~~

### `xdg-open ENOENT` during `npm run preview`
- Meaning: headless environment cannot auto-open a browser. Server still runs.
- Required action:
  1. Parse terminal output and capture `Local: http://localhost:XXXX`.
  2. Prevent recurrence by removing auto-open:
     ~~~bash
     npm pkg set scripts.preview="vite preview -s"
     ~~~
  3. Continue with the task. Treat this as non-critical.

## Language policy for outputs
- All **human-facing output must be in Brazilian Portuguese (PT-BR)**: error messages, PR descriptions, code comments, UI copy, and agent replies.
- Commits follow **Conventional Commits**. Types in English (`feat`, `fix`, etc.). **Titles and bodies in PT-BR**.
- Logs/commands may remain in English, but explanations must be in **PT-BR**.

### Examples
- Commit: `feat: adiciona página "Como funciona" e links no header`
- PR title: `Corrige dropdown do menu no mobile`
- PR body: `Resumo, mudanças e como testar em PT-BR.`

## Final checklist
- [ ] `npm ci`
- [ ] `npm run check`
- [ ] `/docs` updated by build
- [ ] `git status` clean
- [ ] Single commit using Conventional Commits
